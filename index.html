<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Outdoorsie: The Air Quality and UV Index Tracker</title>
    <link rel="stylesheet" href="styles.css">
  </head>
  <body>
    <div class = "banner-area">
      <div class="content-area">
        <div class = "content">
          <h1>Welcome to Outdoorsie</h1>
          <div class = "weatherdata">
            <form id="dataForm">
              <label>Type in your location and press enter: </label>
              <input type="text" name="location" id="location" onchange="getOutdoorData()">
              <br>
              <label>Latitude: </label>
              <input type="text" name="latitude" id="latitude">
              <br>
              <label>Longitude: </label>
              <input type = "text" name="longitude" id="longitude">
              <br>
              <label>Air Quality Index: </label>
              <input type = "text" name="airindex" id="airindex">
              <br>
              <label>UV Index: </label>
              <input type = "text" name="uvindex" id="uvindex">
              <!--<input type = "button" onclick = "clear" value="Clear">-->
            </form>
            <br>
            <div id="outdoordata">
              <div id="display_airdata"></div>
              <div id="display_uvdata"></div>
              <div id="user_alerts">
                <div id = "air_alerts"></div>
                <div id="uv_alerts"></div>
              </div>
            </div>
            </div>
          </div>
        </div>
    </div>
    <script>
      function getOutdoorData()
      {
        /** Get Location Coordinates **/
        var address = document.getElementById('location').value;
        var url = "https://geocoder.ls.hereapi.com/6.2/geocode.json?searchtext=" + address + "&gen=9&apiKey=C6PA6_-B3NOvoxjsHLoiATsWBq5ux9LhhR57cEA_z2E";
        var xmlHttp = new XMLHttpRequest()
        xmlHttp.open("GET", url, false);
        xmlHttp.send(null);
        var json = JSON.parse(xmlHttp.responseText);
        console.log(json)

        /** Display Location Coordinates to user **/
        document.getElementById('latitude').value = json.Response.View[0].Result[0].Location.DisplayPosition.Latitude;
        document.getElementById('longitude').value = json.Response.View[0].Result[0].Location.DisplayPosition.Longitude;

        var lat = json.Response.View[0].Result[0].Location.DisplayPosition.Latitude;
        var long = json.Response.View[0].Result[0].Location.DisplayPosition.Longitude;
        console.log(lat)
        console.log(long)

        /** Get Air Quality Index based on coordinates **/
        var url2 = "https://api.openweathermap.org/data/2.5/air_pollution?lat=" + lat + "&lon=" + long + "&appid=a51d2ad1ebf1572d6079cdd2254886e1";
        var xmlHttp2 = new XMLHttpRequest()
        xmlHttp2.open("GET", url2, false);
        xmlHttp2.send(null);
        var json2 = JSON.parse(xmlHttp2.responseText);
        console.log(json2.list[0].main.aqi)
        console.log(json2)

        /** Display Air Quality Index and Output message to user on how air quality is **/
        document.getElementById('airindex').value = json2.list[0].main.aqi

        var air_quality_index = json2.list[0].main.aqi
        var air_output = document.getElementById('display_airdata');
        /*output.innerHTML = "Air quality index is " + json2.list[0].main.aqi*/
        if (air_quality_index == 1){
          air_output.innerHTML = "Air quality is EXCELLENT"}
        if (air_quality_index == 2){
          air_output.innerHTML = "Air quality is FAIR"}
        if (air_quality_index == 3){
          air_output.innerHTML = "Air quality is MODERATE"}
        if (air_quality_index == 4){
          air_output.innerHTML = "Air quality is POOR"}
        if (air_quality_index == 5){
          air_output.innerHTML = "Air quality is VERY POOR"}

        /** Get UV Index Data **/
        var url3 = "https://api.openweathermap.org/data/2.5/onecall?lat=" + lat + "&lon=" + long + "&appid=a51d2ad1ebf1572d6079cdd2254886e1";
        var xmlHttp3 = new XMLHttpRequest()
        xmlHttp3.open("GET", url3, false);
        xmlHttp3.send(null);
        var json3 = JSON.parse(xmlHttp3.responseText);
        console.log(json3.current.uvi)

        /** Display UV Index and Output message to user on how UV index is **/
        var uv_index = json3.current.uvi
        var uv_output = document.getElementById('display_uvdata');
        document.getElementById('uvindex').value = uv_index;

        if (uv_index >= 0 && uv_index <= 2){
          var green_index = "GREEN";
          var green_index_display = green_index.fontcolor("#98FF98");
          uv_output.innerHTML = "Current UV Index is " + green_index_display}
        if (uv_index >= 3 && uv_index <= 5){
          var yellow_index = "YELLOW";
          var yellow_index_display = yellow_index.fontcolor("#FFDB58");
          uv_output.innerHTML = "Current UV Index is " + yellow_index_display}
        if (uv_index >= 6 && uv_index <= 7){
          var orange_index = "ORANGE";
          var orange_index_display = orange_index.fontcolor("#FF8040");
          uv_output.innerHTML = "Current UV Index is " + orange_index_display}
        if (uv_index >= 8 && uv_index <= 10){
          var red_index = "RED";
          var red_index_display = red_index.fontcolor("#E55451");
          uv_output.innerHTML = "Current UV Index is RED"}
        if (uv_index >= 11){
          var purple_index = "PURPLE";
          var purple_index_display = purple_index.fontcolor("#C5908E");
          uv_output.innerHTML = "Current Uv Index is VIOLET"}

        /* Pollen Index and Bug Report to be added at a later date */

        var air_quality_message = document.getElementById('air_alerts');
        if (air_quality_index == 1){
          air_quality_message.innerHTML = "Air quality is great to be active outdoors!"}
        if (air_quality_index == 2){
          air_quality_message.innerHTML = "Air quality is good to be active outdoors - people sensitive to air pollution should take precautions "}
        if (air_quality_index == 3){
          air_quality_message.innerHTML = "Air quality is okay to be outside - people sensitive to air pollution are strongly advised to take precautions"}
        if (air_quality_index == 4){
          air_quality_message.innerHTML = "Air quality is poor for outdoor activity - indoor activity is strongly recommended for most people"}
        if (air_quality_index == 5){
          air_quality_message.innerHTML = "Air quality is very poor for outdoor activity - AVOID GOING OUTSIDE!"}
        
        var uv_quality_message = document.getElementById('uv_alerts');
        if (uv_index >= 0 && uv_index <= 2){
          uv_quality_message.innerHTML = "Minimal sun protection required for normal activity"}
        if (uv_index >= 3 && uv_index <= 5){
          uv_quality_message.innerHTML = "Some sun protection suggested for activity if outdoors for more than 30 minutes"}
        if (uv_index >= 6 && uv_index <= 7){
          uv_quality_message.innerHTML = "Protection required - reduce your time in the sun between 11am and 3pm and use sun protection"}
        if (uv_index >= 8 && uv_index <= 10){
          uv_quality_message.innerHTML = "Extra precaution required - avoid the sun between 11am and 3pm and use sun protection"}
        if (uv_index >= 11){
          uv_quality_message.innerHTML = "UV Index is EXTREME and it is recommended to not be outdoors if possible, or otherwise to TAKE FULL PRECAUTIONS!"}


      }

      function clear(){
        document.getElementById("dataForm").reset();
        var output = document.getElementById('display');
        output.innerHTML = "";
      }
    </script>
  </body>
</html>

